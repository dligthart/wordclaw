<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="760" viewBox="0 0 1200 760">
  <defs>
    <style>
      .title { font: 700 26px Arial, sans-serif; fill: #0f172a; }
      .subtitle { font: 700 18px Arial, sans-serif; fill: #0f172a; }
      .box { fill: #ffffff; stroke: #1e293b; stroke-width: 2; rx: 10; ry: 10; }
      .label { font: 600 15px Arial, sans-serif; fill: #0f172a; }
      .small { font: 500 13px Arial, sans-serif; fill: #334155; }
      .arrow { stroke: #334155; stroke-width: 2.5; fill: none; marker-end: url(#arrow); }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#334155" />
    </marker>
  </defs>

  <text class="title" x="40" y="42">Versioning Strategy</text>

  <text class="subtitle" x="110" y="90">Update Flow</text>
  <rect class="box" x="80" y="110" width="450" height="78" />
  <text class="label" x="130" y="142">1. Receive update request</text>
  <text class="small" x="130" y="165">content item id + partial payload</text>

  <rect class="box" x="80" y="235" width="450" height="88" />
  <text class="label" x="130" y="267">2. Snapshot current state</text>
  <text class="small" x="130" y="290">insert current data/status/version into</text>
  <text class="small" x="130" y="309">content_item_versions</text>

  <rect class="box" x="80" y="370" width="450" height="88" />
  <text class="label" x="130" y="402">3. Apply update</text>
  <text class="small" x="130" y="425">validate payload + increment version on</text>
  <text class="small" x="130" y="444">content_items row</text>

  <rect class="box" x="80" y="505" width="450" height="78" />
  <text class="label" x="130" y="537">4. Return updated item</text>
  <text class="small" x="130" y="560">history remains append-only</text>

  <line class="arrow" x1="305" y1="188" x2="305" y2="235" />
  <line class="arrow" x1="305" y1="323" x2="305" y2="370" />
  <line class="arrow" x1="305" y1="458" x2="305" y2="505" />

  <text class="subtitle" x="700" y="90">Rollback Flow</text>
  <rect class="box" x="670" y="110" width="450" height="78" />
  <text class="label" x="720" y="142">1. Receive rollback request (version N)</text>
  <text class="small" x="720" y="165">target content item id + version number</text>

  <rect class="box" x="670" y="235" width="450" height="88" />
  <text class="label" x="720" y="267">2. Load snapshot for version N</text>
  <text class="small" x="720" y="290">read data/status from content_item_versions</text>
  <text class="small" x="720" y="309">fail if target version does not exist</text>

  <rect class="box" x="670" y="370" width="450" height="88" />
  <text class="label" x="720" y="402">3. Preserve current head as snapshot</text>
  <text class="small" x="720" y="425">insert current state to versions table</text>
  <text class="small" x="720" y="444">before overwrite</text>

  <rect class="box" x="670" y="505" width="450" height="88" />
  <text class="label" x="720" y="537">4. Restore version N into content_items</text>
  <text class="small" x="720" y="560">write data/status from N, increment version</text>
  <text class="small" x="720" y="579">to create a new head revision</text>

  <line class="arrow" x1="895" y1="188" x2="895" y2="235" />
  <line class="arrow" x1="895" y1="323" x2="895" y2="370" />
  <line class="arrow" x1="895" y1="458" x2="895" y2="505" />
</svg>
